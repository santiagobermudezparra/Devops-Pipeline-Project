#!/bin/bash

if [ "$DEVPOD" = "true" ]; then
  # Only create directories if they don't exist
  mkdir -p ~/.local/bin
  mkdir -p .git/hooks

  # Update PATH if not already present
  if [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
    export PATH="$HOME/.local/bin:$PATH"
    echo 'export PATH="$HOME/.local/bin:$PATH"' >>~/.bashrc
  fi

  # Check before installing pipx
  if ! command -v pipx >/dev/null; then
    pip install --user -U pipx
  fi

  # Check before installing commitizen
  if ! command -v cz >/dev/null || [ "$(cz version)" != "3.13.0" ]; then
    pipx install --force commitizen==3.13.0
  fi

  # Only modify git config if needed
  if ! git config --global --get core.hooksPath >/dev/null; then
    git config --global --unset-all core.hooksPath || true
  fi

  # Check pre-commit installation
  if ! command -v pre-commit >/dev/null; then
    python -m pip install --user pre-commit
  fi

  # Install hooks only if they don't exist
  if [ ! -f .git/hooks/pre-commit ]; then
    pre-commit install
    pre-commit install --hook-type commit-msg
    pre-commit autoupdate
  fi

  # Set hooksPath only after hooks are installed
  git config --global core.hooksPath .git/hooks
fi
